{% extends "base.html" %}

{% block content %}
<div class="editais-container fade-in">
    <a href="{{ url_for('limite.lista_limites') }}" class="btn-back">
        <i class="fas fa-arrow-left"></i> Voltar
    </a>

    <div class="page-header mb-4">
        <h1>Gerar Arquivos Analíticos</h1>
        <p class="text-muted">Gere relatórios analíticos de distribuição por período</p>
    </div>

    <!-- Informações do Período -->
    <div class="card shadow mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">
                <i class="fas fa-info-circle me-2"></i>Período Selecionado
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Edital:</strong> {{ edital.NU_EDITAL }}/{{ edital.ANO }}</p>
                    <p><strong>Período:</strong> {{ periodo.ID_PERIODO }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Data Início:</strong> {{ periodo.DT_INICIO.strftime('%d/%m/%Y') }}</p>
                    <p><strong>Data Fim:</strong> {{ periodo.DT_FIM.strftime('%d/%m/%Y') }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Card 1: Relatório Resumo em PDF -->
    <div class="card shadow mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">
                <i class="fas fa-file-pdf me-2"></i>Relatório Resumo - PDF
            </h5>
        </div>
        <div class="card-body">
            <p class="text-muted">
                Gera um arquivo PDF com o resumo da distribuição do período, mostrando quantidades e valores totais
                distribuídos por assessoria e produto.
            </p>
            <form method="POST" action="{{ url_for('limite.gerar_pdf_resumo', edital_id=edital.ID, periodo_id=periodo.ID_PERIODO) }}" class="mt-3">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-download me-2"></i>Gerar PDF Resumo
                </button>
            </form>
        </div>
    </div>

    <!-- Card 2: Relatórios Analíticos por Empresa em Excel -->
    <div class="card shadow mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">
                <i class="fas fa-file-excel me-2"></i>Relatórios Analíticos por Empresa - Excel
            </h5>
        </div>
        <div class="card-body">
            <p class="text-muted">
                Gera arquivos Excel individuais para cada empresa credenciada do período, contendo a relação
                completa de contratos distribuídos com detalhes de produtos, valores, dias de atraso e critérios.
            </p>

            {% if total_empresas > 0 %}
            <div class="alert alert-info" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                Serão gerados <strong>{{ total_empresas }} arquivos Excel</strong>, um para cada empresa credenciada no período.
            </div>
            {% endif %}

            <form method="POST" action="{{ url_for('limite.gerar_excel_empresas', edital_id=edital.ID, periodo_id=periodo.ID_PERIODO) }}" class="mt-3">
                <button type="submit" class="btn btn-success" {% if total_empresas == 0 %}disabled{% endif %}>
                    <i class="fas fa-download me-2"></i>Gerar Arquivos Excel por Empresa
                </button>
            </form>

            {% if total_empresas == 0 %}
            <div class="alert alert-warning mt-3" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Não há empresas credenciadas com distribuição para este período.
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Card 3: Relatório Analítico por CPF - PDF (NOVO) -->
    <div class="card shadow mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">
                <i class="fas fa-file-pdf me-2"></i>Resumo da Distribuição por CPF/CNPJ - PDF
            </h5>
        </div>
        <div class="card-body">
            <p class="text-muted">
                Gera um arquivo PDF com o resumo da distribuição agregado por empresa de cobrança, mostrando
                <strong>quantidade de contratos, quantidade de CPFs/CNPJs únicos e saldo devedor total</strong>.
            </p>
            <form method="POST" action="{{ url_for('limite.gerar_pdf_analitico_cpf', edital_id=edital.ID, periodo_id=periodo.ID_PERIODO) }}" class="mt-3">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-download me-2"></i>Gerar PDF Analítico por CPF
                </button>
            </form>
        </div>
    </div>

</div>
{% endblock %}