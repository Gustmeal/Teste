{% extends "base.html" %}

{% block content %}
<div class="container-fluid fade-in">
    <a href="{{ url_for('sumov.deliberacao_pagamento') }}" class="btn-back">
        <i class="fas fa-arrow-left"></i> Voltar
    </a>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold header-with-back">
            <i class="fas fa-edit text-warning me-2"></i> Editar Deliberação - Contrato {{ deliberacao.NU_CONTRATO }}
        </h1>
        <button type="button"
                class="btn btn-success"
                onclick="baixarPDFDetalhado('{{ deliberacao.NU_CONTRATO }}', this)">
            <i class="fas fa-file-pdf me-2"></i>Baixar PDF
        </button>
    </div>

    <!-- Card do Formulário -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-gradient-warning text-white">
            <h5 class="mb-0">
                <i class="fas fa-edit me-2"></i>Dados da Deliberação
            </h5>
        </div>
        <div class="card-body p-4">
            <form method="POST" action="{{ url_for('sumov.deliberacao_pagamento_nova') }}">

                <!-- Campo Hidden: Contrato -->
                <input type="hidden" name="contrato" value="{{ deliberacao.NU_CONTRATO }}">

                <!-- ==== SEÇÃO 1: IDENTIFICAÇÃO ==== -->
                <div class="border-bottom pb-3 mb-4">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-id-card me-2"></i>Identificação
                    </h5>

                    <!-- Contrato/Imóvel (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-file-contract text-primary me-1"></i>
                            Contrato/Imóvel (ID)
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ deliberacao.NU_CONTRATO }}"
                               readonly>
                    </div>

                    <!-- Analista (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-user text-success me-1"></i>
                            Colaborador que Analisou
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ deliberacao.COLABORADOR_ANALISOU or '-' }}"
                               readonly>
                    </div>

                    <!-- Data da Análise (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-calendar text-info me-1"></i>
                            Data da Análise
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ deliberacao.DT_ANALISE.strftime('%d/%m/%Y') if deliberacao.DT_ANALISE else '-' }}"
                               readonly>
                    </div>

                    <!-- Matrícula (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-id-badge text-secondary me-1"></i>
                            Matrícula (Caixa/Emgea)
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ deliberacao.MATRICULA_CAIXA_EMGEA or '-' }}"
                               readonly>
                    </div>

                    <!-- Data de Arrematação (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-calendar-plus text-warning me-1"></i>
                            Data da Arrematação/Aquisição (RM)
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ deliberacao.DT_ARREMATACAO_AQUISICAO.strftime('%d/%m/%Y') if deliberacao.DT_ARREMATACAO_AQUISICAO else '-' }}"
                               readonly>
                    </div>

                    <!-- Data de Entrada no Estoque (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-warehouse text-primary me-1"></i>
                            Data de Entrada no Estoque
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ deliberacao.DT_ENTRADA_ESTOQUE.strftime('%d/%m/%Y') if deliberacao.DT_ENTRADA_ESTOQUE else '-' }}"
                               readonly>
                    </div>
                </div>

                <!-- ==== SEÇÃO 2: COBRANÇA E DÍVIDA ==== -->
                <div class="border-bottom pb-3 mb-4">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-file-invoice-dollar me-2"></i>Cobrança e Dívida
                    </h5>

                    <!-- Período Prescrito (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-clock text-danger me-1"></i>
                            Período Prescrito
                        </label>
                        <textarea class="form-control bg-light"
                                  rows="2"
                                  readonly>{{ deliberacao.PERIODO_PRESCRITO or '-' }}</textarea>
                    </div>

                    <!-- Período da Cobrança dos Débitos (readonly) -->
                    {% if deliberacao.DT_PERIODO_COBRANCA_INICIO and deliberacao.DT_PERIODO_COBRANCA_FIM %}
                    <div class="card bg-light border-info mb-3">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-calendar-alt me-2"></i>Período da Cobrança dos Débitos
                            </h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-0">
                                <strong>De:</strong> {{ deliberacao.DT_PERIODO_COBRANCA_INICIO.strftime('%d/%m/%Y') }}
                                <strong class="ms-3">Até:</strong> {{ deliberacao.DT_PERIODO_COBRANCA_FIM.strftime('%d/%m/%Y') }}
                            </p>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Valor Inicial da Dívida (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-money-bill text-warning me-1"></i>
                            Valor Inicial da Dívida
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ 'R$ {:,.2f}'.format(deliberacao.VR_DIVIDA_CONDOMINIO_1).replace(',', 'X').replace('.', ',').replace('X', '.') if deliberacao.VR_DIVIDA_CONDOMINIO_1 else 'R$ 0,00' }}"
                               readonly>
                    </div>

                    <!-- Card com Débito Calculado EMGEA -->
                    <div class="card bg-light border-primary mb-3">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-calculator me-2"></i>Débito Calculado - EMGEA
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- Índice Econômico -->
                                <div class="col-md-12 mb-3">
                                    <label class="form-label fw-bold text-secondary">
                                        <i class="fas fa-chart-line me-1"></i>
                                        Índice Econômico Utilizado
                                    </label>
                                    <input type="text"
                                           class="form-control bg-white"
                                           value="{{ deliberacao.INDICE_DEBITO_EMGEA or '-' }}"
                                           readonly>
                                </div>

                                <!-- Valor SEM Honorários -->
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold text-secondary">
                                        <i class="fas fa-file-invoice me-1"></i>
                                        Valor da Dívida (sem Honorários)
                                    </label>
                                    <input type="text"
                                           class="form-control bg-white"
                                           value="{{ 'R$ {:,.2f}'.format(deliberacao.VR_DEBITO_CALCULADO_EMGEA - deliberacao.VR_HONORARIOS_EMGEA).replace(',', 'X').replace('.', ',').replace('X', '.') if deliberacao.VR_DEBITO_CALCULADO_EMGEA and deliberacao.VR_HONORARIOS_EMGEA else 'R$ 0,00' }}"
                                           readonly>
                                </div>

                                <!-- Percentual de Honorários -->
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold text-secondary">
                                        <i class="fas fa-percent me-1"></i>
                                        Percentual de Honorários
                                    </label>
                                    <input type="text"
                                           class="form-control bg-white"
                                           value="{{ '{:,.2f}%'.format(deliberacao.PERC_HONORARIOS_EMGEA).replace('.', ',') if deliberacao.PERC_HONORARIOS_EMGEA else '0,00%' }}"
                                           readonly>
                                </div>

                                <!-- Valor dos Honorários -->
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold text-warning">
                                        <i class="fas fa-gavel me-1"></i>
                                        Valor dos Honorários
                                    </label>
                                    <input type="text"
                                           class="form-control bg-white border-warning"
                                           value="{{ 'R$ {:,.2f}'.format(deliberacao.VR_HONORARIOS_EMGEA).replace(',', 'X').replace('.', ',').replace('X', '.') if deliberacao.VR_HONORARIOS_EMGEA else 'R$ 0,00' }}"
                                           readonly>
                                </div>

                                <!-- Valor TOTAL COM Honorários -->
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold text-success">
                                        <i class="fas fa-money-bill-wave me-1"></i>
                                        VALOR TOTAL (com Honorários)
                                    </label>
                                    <input type="text"
                                           class="form-control bg-white border-success fw-bold"
                                           value="{{ 'R$ {:,.2f}'.format(deliberacao.VR_DEBITO_CALCULADO_EMGEA).replace(',', 'X').replace('.', ',').replace('X', '.') if deliberacao.VR_DEBITO_CALCULADO_EMGEA else 'R$ 0,00' }}"
                                           readonly>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ✅ NOVO: Card com Resumo por Tipo de Parcela -->
                    {% if totais_por_tipo and totais_por_tipo|length > 0 %}
                    <div class="card shadow-sm mb-3">
                        <div class="card-header bg-success text-white py-2">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-pie me-2"></i>Resumo por Tipo de Parcela
                            </h6>
                        </div>
                        <div class="card-body py-3">
                            <div class="table-responsive">
                                <table class="table table-sm table-bordered table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="text-center" style="width: 15%;">ID Tipo</th>
                                            <th style="width: 35%;">Descrição do Tipo</th>
                                            <th class="text-center" style="width: 20%;">Quantidade</th>
                                            <th class="text-end" style="width: 30%;">Valor Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for tipo in totais_por_tipo %}
                                        <tr>
                                            <td class="text-center">{{ tipo.id_tipo }}</td>
                                            <td>{{ tipo.descricao }}</td>
                                            <td class="text-center">{{ tipo.quantidade }}</td>
                                            <td class="text-end">
                                                <strong>{{ 'R$ {:,.2f}'.format(tipo.valor_total).replace(',', 'X').replace('.', ',').replace('X', '.') }}</strong>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                    <tfoot>
                                        <tr class="table-info">
                                            <th colspan="2" class="text-end">TOTAL GERAL:</th>
                                            <th class="text-center">
                                                <strong>{{ totais_por_tipo|sum(attribute='quantidade') }}</strong>
                                            </th>
                                            <th class="text-end">
                                                <strong>{{ 'R$ {:,.2f}'.format(totais_por_tipo|sum(attribute='valor_total')).replace(',', 'X').replace('.', ',').replace('X', '.') }}</strong>
                                            </th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Hidden field para POST -->
                    <input type="hidden" name="indice_economico" value="0">
                </div>

                <!-- ==== SEÇÃO 3: AVALIAÇÃO E VENDA ==== -->
                <div class="border-bottom pb-3 mb-4">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-home me-2"></i>Avaliação e Venda
                    </h5>

                    <!-- Valor de avaliação (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-home text-primary me-1"></i>
                            Valor de Avaliação
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ 'R$ {:,.2f}'.format(deliberacao.VR_AVALIACAO).replace(',', 'X').replace('.', ',').replace('X', '.') if deliberacao.VR_AVALIACAO else 'R$ 0,00' }}"
                               readonly>
                    </div>

                    <!-- Data do laudo (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-calendar-alt text-info me-1"></i>
                            Data do Laudo
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ deliberacao.DT_LAUDO.strftime('%d/%m/%Y') if deliberacao.DT_LAUDO else '-' }}"
                               readonly>
                    </div>

                    <!-- Status do imóvel (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-info-circle text-warning me-1"></i>
                            Status do Imóvel
                        </label>
                        <input type="text"
                               class="form-control bg-light"
                               value="{{ deliberacao.STATUS_IMOVEL or '-' }}"
                               readonly>
                    </div>

                    <!-- Seção Condicional - Aparece se STATUS = VENDIDO -->
                    {% if deliberacao.STATUS_IMOVEL and 'VENDIDO' in deliberacao.STATUS_IMOVEL.upper() %}
                    <div class="alert alert-success">
                        <h6 class="alert-heading">
                            <i class="fas fa-check-circle me-2"></i>Imóvel Vendido - Informações da Venda
                        </h6>
                        <hr>

                        <!-- Valor de venda (readonly) -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                <i class="fas fa-dollar-sign text-success me-1"></i>
                                Valor de Venda
                            </label>
                            <input type="text"
                                   class="form-control bg-white"
                                   value="{{ 'R$ {:,.2f}'.format(deliberacao.VR_VENDA).replace(',', 'X').replace('.', ',').replace('X', '.') if deliberacao.VR_VENDA else 'R$ 0,00' }}"
                                   readonly>
                        </div>

                        <!-- Data da venda (readonly) -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                <i class="fas fa-calendar-check text-success me-1"></i>
                                Data da Venda
                            </label>
                            <input type="text"
                                   class="form-control bg-white"
                                   value="{{ deliberacao.DT_VENDA.strftime('%d/%m/%Y') if deliberacao.DT_VENDA else '-' }}"
                                   readonly>
                        </div>

                        <!-- Nome do Comprador (readonly) -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                <i class="fas fa-user-check text-primary me-1"></i>
                                Nome do Adquirente
                            </label>
                            <input type="text"
                                   class="form-control bg-white"
                                   value="{{ deliberacao.NOME_COMPRADOR or '-' }}"
                                   readonly>
                        </div>

                        <!-- Tipo de Pagamento da Venda (readonly) -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">
                                <i class="fas fa-credit-card text-info me-1"></i>
                                Tipo de Pagamento
                            </label>
                            <div class="form-control bg-white">
                                {% if deliberacao.TIPO_PAGAMENTO_VENDA == 'A_VISTA' %}
                                    <i class="fas fa-money-bill-wave text-success me-2"></i>
                                    <span class="badge bg-success">À Vista</span>
                                {% elif deliberacao.TIPO_PAGAMENTO_VENDA == 'PARCELADO' %}
                                    <i class="fas fa-credit-card text-primary me-2"></i>
                                    <span class="badge bg-primary">Parcelado</span>
                                {% else %}
                                    -
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Data do registro (editável) -->
                    <div class="mb-3">
                        <label for="dt_registro" class="form-label fw-bold">
                            <i class="fas fa-edit text-primary me-1"></i>
                            Data do Registro <span class="text-danger">*</span>
                        </label>
                        <input type="date"
                               class="form-control"
                               id="dt_registro"
                               name="dt_registro"
                               value="{{ deliberacao.DT_REGISTRO.strftime('%Y-%m-%d') if deliberacao.DT_REGISTRO else '' }}"
                               required>
                    </div>
                </div>

                <!-- ==== SEÇÃO 4: PARTE FINAL - AÇÕES E PROCESSOS ==== -->
                <div class="border-bottom pb-3 mb-4">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-balance-scale me-2"></i>Ações e Processos Judiciais
                    </h5>

                    <!-- Gravames na matrícula (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-exclamation-triangle text-danger me-1"></i>
                            Gravames na Matrícula
                        </label>
                        <textarea class="form-control bg-light"
                                  rows="2"
                                  readonly>{{ deliberacao.GRAVAME_MATRICULA or '-' }}</textarea>
                    </div>

                    <!-- Ações Negociais Administrativas (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-clipboard-list text-primary me-1"></i>
                            Ações Negociais Administrativas
                        </label>
                        <textarea class="form-control bg-light"
                                  rows="3"
                                  readonly>{{ deliberacao.ACOES_NEGOCIAIS_ADMINISTRATIVAS or '-' }}</textarea>
                    </div>

                    <!-- Processos judiciais (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-gavel text-warning me-1"></i>
                            Situação Judicial - Ações Negociais Judiciais
                        </label>
                        <textarea class="form-control bg-light"
                                  rows="3"
                                  readonly>{{ deliberacao.NR_PROCESSOS_JUDICIAIS or '-' }}</textarea>
                    </div>

                    <!-- Vara do processo (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-landmark text-primary me-1"></i>
                            Vara do Processo
                        </label>
                        <textarea class="form-control bg-light"
                                  rows="3"
                                  readonly>{{ deliberacao.VARA_PROCESSO or '-' }}</textarea>
                    </div>

                    <!-- Fase do processo (readonly) -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-tasks text-info me-1"></i>
                            Fase do Processo
                        </label>
                        <textarea class="form-control bg-light"
                                  rows="3"
                                  readonly>{{ deliberacao.FASE_PROCESSO or '-' }}</textarea>
                    </div>

                    <!-- Relatório da assessoria jurídica (editável) -->
                    <div class="mb-3">
                        <label for="relatorio_assessoria_juridica" class="form-label fw-bold">
                            <i class="fas fa-file-alt text-secondary me-1"></i>
                            Relatório da Assessoria Jurídica
                        </label>
                        <textarea class="form-control"
                                  id="relatorio_assessoria_juridica"
                                  name="relatorio_assessoria_juridica"
                                  rows="4"
                                  placeholder="Digite o relatório da assessoria jurídica">{{ deliberacao.RELATORIO_ASSESSORIA_JURIDICA or '' }}</textarea>
                    </div>
                </div>

                <!-- ==== SEÇÃO 5: DÉBITOS PAGOS ==== -->
                <div class="border-bottom pb-3 mb-4">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-receipt me-2"></i>Demais Débitos Pagos pela EMGEA
                    </h5>

                    <!-- Card com totais -->
                    <div class="card bg-light border-secondary mb-3">
                        <div class="card-header bg-secondary text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-calculator me-2"></i>Resumo de Débitos Pagos
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- SISDEX -->
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-wrench text-primary me-1"></i>
                                        SISDEX
                                    </label>
                                    <input type="text"
                                           class="form-control bg-white"
                                           value="{{ 'R$ {:,.2f}'.format(deliberacao.VR_DEBITOS_SISDEX).replace(',', 'X').replace('.', ',').replace('X', '.') if deliberacao.VR_DEBITOS_SISDEX else 'R$ 0,00' }}"
                                           readonly>
                                </div>

                                <!-- SISGEA -->
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-building text-success me-1"></i>
                                        SISGEA
                                    </label>
                                    <input type="text"
                                           class="form-control bg-white"
                                           value="{{ 'R$ {:,.2f}'.format(deliberacao.VR_DEBITOS_SISGEA).replace(',', 'X').replace('.', ',').replace('X', '.') if deliberacao.VR_DEBITOS_SISGEA else 'R$ 0,00' }}"
                                           readonly>
                                </div>

                                <!-- Total -->
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-calculator text-warning me-1"></i>
                                        Total
                                    </label>
                                    <input type="text"
                                           class="form-control bg-white border-warning fw-bold"
                                           value="{{ 'R$ {:,.2f}'.format(deliberacao.VR_DEBITOS_TOTAL).replace(',', 'X').replace('.', ',').replace('X', '.') if deliberacao.VR_DEBITOS_TOTAL else 'R$ 0,00' }}"
                                           readonly>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Penalidade de ANS - CAIXA (editável) -->
                    <div class="mb-3">
                        <label for="penalidade_ans_caixa" class="form-label fw-bold">
                            <i class="fas fa-exclamation-triangle text-danger me-1"></i>
                            Penalidade de ANS - CAIXA
                        </label>
                        <textarea class="form-control"
                                  id="penalidade_ans_caixa"
                                  name="penalidade_ans_caixa"
                                  rows="3"
                                  placeholder="Descreva as penalidades de ANS aplicadas pela CAIXA">{{ deliberacao.PENALIDADE_ANS_CAIXA or '' }}</textarea>
                    </div>

                    <!-- Prejuízo Financeiro - CAIXA (editável) -->
                    <div class="mb-3">
                        <label for="prejuizo_financeiro_caixa" class="form-label fw-bold">
                            <i class="fas fa-chart-line text-danger me-1"></i>
                            Prejuízo Financeiro - CAIXA
                        </label>
                        <textarea class="form-control"
                                  id="prejuizo_financeiro_caixa"
                                  name="prejuizo_financeiro_caixa"
                                  rows="3"
                                  placeholder="Descreva o prejuízo financeiro da CAIXA">{{ deliberacao.PREJUIZO_FINANCEIRO_CAIXA or '' }}</textarea>
                    </div>
                </div>

                <!-- ==== SEÇÃO 6: CONSIDERAÇÕES FINAIS ==== -->
                <div class="mb-4">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-comments me-2"></i>Considerações Finais
                    </h5>

                    <!-- Considerações do Analista (editável) -->
                    <div class="mb-3">
                        <label for="consideracoes_analista" class="form-label fw-bold">
                            <i class="fas fa-user-edit text-info me-1"></i>
                            Considerações do Analista GEADI
                        </label>
                        <textarea class="form-control"
                                  id="consideracoes_analista"
                                  name="consideracoes_analista"
                                  rows="5"
                                  placeholder="Digite as considerações do analista GEADI">{{ deliberacao.CONSIDERACOES_ANALISTA_GEADI or '' }}</textarea>
                    </div>

                    <!-- Considerações do Gestor GEADI (editável) -->
                    <div class="mb-3">
                        <label for="consideracoes_gestor" class="form-label fw-bold">
                            <i class="fas fa-user-tie text-primary me-1"></i>
                            Considerações do Gestor GEADI
                        </label>
                        <textarea class="form-control"
                                  id="consideracoes_gestor"
                                  name="consideracoes_gestor"
                                  rows="5"
                                  placeholder="Digite as considerações do gestor GEADI">{{ deliberacao.CONSIDERACOES_GESTOR_GEADI or '' }}</textarea>
                    </div>

                    <!-- Considerações do Gestor SUMOV (editável) -->
                    <div class="mb-3">
                        <label for="consideracoes_gestor_sumov" class="form-label fw-bold">
                            <i class="fas fa-user-tie text-warning me-1"></i>
                            Considerações Finais do Gestor da SUMOV
                        </label>
                        <textarea class="form-control"
                                  id="consideracoes_gestor_sumov"
                                  name="consideracoes_gestor_sumov"
                                  rows="5"
                                  placeholder="Digite as considerações finais do gestor SUMOV">{{ deliberacao.CONSIDERACOES_GESTOR_SUMOV or '' }}</textarea>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="d-flex justify-content-end gap-2">
                    <a href="{{ url_for('sumov.deliberacao_pagamento') }}" class="btn btn-secondary">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </a>
                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="fas fa-save me-2"></i>Salvar Alterações
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>

<script>
// Função para baixar PDF com feedback visual
function baixarPDFDetalhado(contrato, botao) {
    const conteudoOriginal = botao.innerHTML;

    botao.disabled = true;
    botao.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Gerando PDF...';

    const link = document.createElement('a');
    link.href = `/sumov/deliberacao-pagamento/pdf/${contrato}`;
    link.download = `Deliberacao_Pagamento_${contrato}.pdf`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    setTimeout(() => {
        botao.disabled = false;
        botao.innerHTML = conteudoOriginal;
    }, 3000);
}
</script>
{% endblock %}